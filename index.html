<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOKS | ELITE STABLE</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Outfit:wght@300;400;600;900&family=Dancing+Script:wght@700&family=Crimson+Text:ital,wght@1,600&display=swap');

        :root {
            --bg: #05080a; --glass: rgba(10, 15, 25, 0.88);
            --gold: #eab308; --neon-teal: #06b6d4;
            --green: #10b981; --red: #f43f5e; --border: rgba(234, 179, 8, 0.15);
        }

        body { 
            margin: 0; font-family: 'Outfit', sans-serif; 
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.unsplash.com/photo-1507679799987-c73779587ccf?q=80&w=2071&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #f8fafc; min-height: 100vh; 
        }

        /* --- DASHBOARD UI --- */
        .dash-header { text-align: center; padding: 40px 20px 10px; }
        .main-title { font-family: 'Cinzel', serif; font-size: clamp(32px, 8vw, 52px); font-weight: 900; letter-spacing: 8px; margin: 0; background: linear-gradient(to bottom, #fde68a, #b45309); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .year-bg-pin { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--gold); padding: 12px 25px; border-radius: 50px; width: fit-content; margin: 25px auto; backdrop-filter: blur(15px); display: flex; align-items: center; gap: 15px; }
        .year-bg-pin select { background: transparent; border: none; color: #fff; font-weight: 900; font-size: 16px; outline: none; cursor: pointer; }

        .treasurer-config { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px auto; padding: 0 15px; }
        .t-box { background: var(--glass); border: 1px solid var(--border); padding: 12px 15px; border-radius: 15px; flex: 1; min-width: 200px; max-width: 300px; }
        .t-box label { font-size: 10px; color: var(--gold); text-transform: uppercase; display: block; margin-bottom: 5px; font-weight: 900; }
        .t-box input { background: transparent; border: none; border-bottom: 1.5px solid var(--gold); color: #fff; text-align: center; font-family: 'Cinzel'; font-weight: 900; font-size: 14px; outline: none; width: 100%; }

        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1100px; margin: 30px auto; width: 95%; }
        .stat-card { background: var(--glass); padding: 25px; border-radius: 28px; border: 1px solid var(--border); text-align: center; transition: 0.3s; }
        .stat-card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .stat-val { font-size: 32px; font-weight: 900; font-family: 'Cinzel'; margin-top: 10px; }

        .form-box { background: var(--glass); padding: 30px; border-radius: 35px; border: 1px solid var(--border); max-width: 850px; margin: 30px auto; width: 90%; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-grid input, .form-grid select { background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border); color: white; padding: 14px; border-radius: 14px; outline: none; }
        .btn-save { grid-column: 1 / -1; background: linear-gradient(135deg, #fbbf24, #d97706); color: #000; border: none; padding: 18px; border-radius: 15px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; }

        .search-bar { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; outline: none; box-sizing: border-box; }

        .lists-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; max-width: 1400px; margin: 40px auto; padding: 0 20px; }
        @media (max-width: 500px) { .lists-container { grid-template-columns: 1fr; } }

        .ledger-box { background: var(--glass); padding: 20px; border-radius: 25px; border: 1px solid var(--border); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 400px; }
        th { text-align: left; color: var(--gold); padding: 12px; border-bottom: 2.5px solid var(--border); font-weight: 900; }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .btn-mini { padding: 6px 10px; border-radius: 8px; cursor: pointer; border: 1px solid #444; background: #000; color: #fff; font-size: 11px; margin-right: 2px; }

        /* --- PRINT AREA --- */
        #printArea { display: none; }
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { display: block !important; position: absolute; left: 0; top: 0; width: 100%; color: black !important; background: white !important; }
            .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            .report-table th, .report-table td { border: 1px solid black; padding: 8px; text-align: left; }
        }
    </style>
</head>
<body>

<div class="dash-header no-print">
    <h1 class="main-title">TREASURE BOOKS</h1>
    <div style="color:var(--gold); letter-spacing:3px; font-weight:600;">B.B.C MARANG BUNDU</div>
    <div style="font-size:12px; opacity:0.7;">Reg.no :- MBJ8750 - 13 Of 2022</div>
</div>

<div class="year-bg-pin no-print">
    <label style="color:var(--gold)">SESSION :</label>
    <select id="yearFilter" onchange="loadView()"></select>
</div>

<div class="treasurer-config no-print">
    <div class="t-box"><label>Principal Treasurer</label><input type="text" id="cfgT" placeholder="Name" onchange="updateCfg()"></div>
    <div class="t-box"><label>Assistant Treasurer</label><input type="text" id="cfgAT" placeholder="Name" onchange="updateCfg()"></div>
</div>

<div class="stats-container no-print">
    <div class="stat-card"><div style="color:var(--green); font-weight:900;">COLLECTIONS</div><div class="stat-val" id="sumIn" style="color:var(--green)">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--red); font-weight:900;">EXPENDITURES</div><div class="stat-val" id="sumOut" style="color:var(--red)">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--gold); font-weight:900;">BALANCE</div><div class="stat-val" id="sumBal" style="color:var(--gold)">‚Çπ 0</div></div>
</div>

<div class="form-box no-print">
    <div class="form-grid">
        <select id="eType" style="grid-column: 1 / -1;"><option value="donation">‚ú® CREDIT (Collection)</option><option value="expense">üõ°Ô∏è DEBIT (Expenditure)</option></select>
        <input type="date" id="eDate">
        <input type="number" id="eAmount" placeholder="Amount ‚Çπ">
        <input type="text" id="eName" placeholder="Name / Purpose">
        <button class="btn-save" onclick="saveEntry()">Save Transaction</button>
    </div>
</div>

<div class="lists-container no-print">
    <div class="ledger-box">
        <h3 style="color:var(--green); display:flex; justify-content:space-between; align-items:center;">
            Collections 
            <button class="btn-mini" onclick="printReport('don')" style="background:var(--green); color:black; font-weight:bold;">Report</button>
        </h3>
        <input type="text" id="searchDon" class="search-bar" placeholder="Search donor name..." onkeyup="loadView()">
        <table><thead><tr><th>Date</th><th>Donor</th><th>Amount</th><th>Action</th></tr></thead><tbody id="bodyDon"></tbody></table>
    </div>
    <div class="ledger-box">
        <h3 style="color:var(--red); display:flex; justify-content:space-between; align-items:center;">
            Expenditures 
            <button class="btn-mini" onclick="printReport('exp')" style="background:var(--red); color:white; font-weight:bold;">Report</button>
        </h3>
        <input type="text" id="searchExp" class="search-bar" placeholder="Search purpose..." onkeyup="loadView()">
        <table><thead><tr><th>Date</th><th>Purpose</th><th>Amount</th><th>Action</th></tr></thead><tbody id="bodyExp"></tbody></table>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let localData = { donations: {}, expenses: {}, config: { tName: "", atName: "" } };

    db.ref().on('value', snap => {
        const v = snap.val() || {};
        localData.donations = v.donations || {};
        localData.expenses = v.expenses || {};
        if(v.config) {
            localData.config = v.config;
            document.getElementById('cfgT').value = v.config.tName || "";
            document.getElementById('cfgAT').value = v.config.atName || "";
        }
        loadView();
    });

    function updateCfg() {
        db.ref('config').update({ tName: document.getElementById('cfgT').value, atName: document.getElementById('cfgAT').value });
    }

    function numToWords(n) {
        const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
        const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        const format = (num) => {
            if (num == 0) return '';
            if (num < 20) return a[num];
            if (num < 100) return b[Math.floor(num / 10)] + (num % 10 !== 0 ? ' ' + a[num % 10] : '');
            if (num < 1000) return a[Math.floor(num / 100)] + ' Hundred ' + (num % 100 !== 0 ? 'and ' + format(num % 100) : '');
            if (num < 100000) return format(Math.floor(num / 1000)) + ' Thousand ' + (num % 1000 !== 0 ? format(num % 1000) : '');
            if (num < 10000000) return format(Math.floor(num / 100000)) + ' Lakh ' + (num % 100000 !== 0 ? format(num % 100000) : '');
            return format(Math.floor(num / 10000000)) + ' Crore ' + (num % 10000000 !== 0 ? format(num % 10000000) : '');
        }
        return n == 0 ? 'Zero Only' : format(n) + 'Only';
    }

    function loadView() {
        const fy = document.getElementById('yearFilter').value;
        const bD = document.getElementById('bodyDon'), bE = document.getElementById('bodyExp');
        const sDon = document.getElementById('searchDon').value.toLowerCase();
        const sExp = document.getElementById('searchExp').value.toLowerCase();
        
        let tin = 0, tout = 0; bD.innerHTML = ''; bE.innerHTML = '';

        Object.entries(localData.donations).filter(([_, x]) => x.year == fy && x.name.toLowerCase().includes(sDon)).sort((a,b)=>new Date(b[1].date)-new Date(a[1].date)).forEach(([k, x]) => {
            tin += Number(x.amt);
            bD.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="printReceipt('${k}')">Bill</button> <button class="btn-mini" onclick="deleteEntry('donations','${k}')">üóëÔ∏è</button></td></tr>`;
        });

        Object.entries(localData.expenses).filter(([_, x]) => x.year == fy && x.name.toLowerCase().includes(sExp)).sort((a,b)=>new Date(b[1].date)-new Date(a[1].date)).forEach(([k, x]) => {
            tout += Number(x.amt);
            bE.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="deleteEntry('expenses','${k}')">üóëÔ∏è</button></td></tr>`;
        });

        document.getElementById('sumIn').innerText = '‚Çπ ' + tin.toLocaleString();
        document.getElementById('sumOut').innerText = '‚Çπ ' + tout.toLocaleString();
        document.getElementById('sumBal').innerText = '‚Çπ ' + (tin - tout).toLocaleString();
    }

    function saveEntry() {
        const t = document.getElementById('eType').value, d = document.getElementById('eDate').value, n = document.getElementById('eName').value, a = document.getElementById('eAmount').value;
        if(!d || !n || !a) return alert("All fields are required!");
        db.ref(t === 'donation' ? 'donations/' : 'expenses/').push({ date: d, name: n, amt: Number(a), year: new Date(d).getFullYear() });
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = '';
    }

    function deleteEntry(p, k) { if(confirm("Delete permanently?")) db.ref(p + '/' + k).remove(); }

    function printReceipt(key) {
        const item = localData.donations[key];
        const words = numToWords(item.amt);
        document.getElementById('printArea').innerHTML = `
            <div style="width:100%; max-width:800px; padding:40px; border:8px double #000; background:white; color:black; font-family:'Outfit'; position:relative;">
                <center>
                    <h1 style="font-family:'Cinzel'; font-size:35px; margin:0;">52nd SAHID DIWAS 2026</h1>
                    <h2 style="font-family:'Cinzel'; font-size:22px; margin:5px 0;">B.B.C MARANG BUNDU</h2>
                    <p style="font-weight:bold; font-size:14px; margin-top:0;">Reg.no :- MBJ8750 - 13 Of 2022</p>
                    <div style="background:black; color:white; padding:10px 60px; font-size:24px; font-weight:bold; margin-top:10px;">DONATION RECEIPT</div>
                </center>

                <div style="display:flex; justify-content:space-between; margin-top:30px; font-size:18px;">
                    <span>No: <b style="border-bottom:1px solid #000;">#${key.substr(-5).toUpperCase()}</b></span>
                    <span>Date: <b style="border-bottom:1px solid #000;">${item.date}</b></span>
                </div>

                <div style="font-size:22px; line-height:2.5; font-family:'Crimson Text'; margin-top:30px;">
                    Received with heartful thanks from Mr./Ms. <span style="border-bottom:1.5px dotted #000; font-weight:bold; display:inline-block; min-width:350px;">${item.name}</span> <br>
                    the sum of Rupees <span style="border-bottom:1.5px dotted #000; font-weight:bold; display:inline-block; min-width:400px; text-transform:capitalize;">${words}</span> <br>
                    towards <b style="text-decoration:underline;">52nd Sahid Diwas Celebration Fund</b>.
                </div>

                <div style="font-size:38px; font-weight:900; border:4px double #000; padding:15px 40px; width:fit-content; margin:40px auto; background:#f9f9f9;">‚Çπ ${Number(item.amt).toLocaleString()} /-</div>

                <div style="text-align:center; margin-top:20px; border-top:1px dashed #777; padding-top:20px;">
                    <p style="font-style:italic; font-size:18px; color:#333; margin-bottom:5px;">"Aapka yogdaan humare samaj ke liye ek misaal hai. Hum aapke shukraguzaar hain!"</p>
                    <h3 style="font-family:'Dancing Script'; font-size:28px; margin:0;">Thank You for your Generosity!</h3>
                </div>

                <div style="display:flex; justify-content:flex-end; margin-top:50px; padding-right:20px;">
                    <div style="text-align:center;">
                        <span style="font-family:'Dancing Script'; font-size:28px; display:block;">${localData.config.tName}</span>
                        <div style="border-top:2px solid #000; font-weight:900; width:200px; font-size:12px; text-transform:uppercase; padding-top:5px;">Principal Treasurer</div>
                    </div>
                </div>
            </div>`;
        window.print();
    }

    function printReport(type) {
        const fy = document.getElementById('yearFilter').value;
        const data = type === 'don' ? localData.donations : localData.expenses;
        const title = type === 'don' ? 'COLLECTION REPORT' : 'EXPENDITURE REPORT';
        let total = 0;

        let rows = Object.values(data).filter(x => x.year == fy).sort((a,b)=>new Date(a.date)-new Date(b.date)).map((x, i) => {
            total += Number(x.amt);
            return `<tr><td>${i+1}</td><td>${x.date}</td><td>${x.name}</td><td>‚Çπ ${Number(x.amt).toLocaleString()}</td></tr>`;
        }).join('');

        document.getElementById('printArea').innerHTML = `
            <div style="padding:40px; background:white; color:black; font-family:'Outfit';">
                <center>
                    <h1 style="font-family:'Cinzel'; margin:0;">B.B.C MARANG BUNDU</h1>
                    <p style="margin:5px 0;">Reg.no :- MBJ8750 - 13 Of 2022</p>
                    <h2 style="background:black; color:white; padding:10px; text-transform:uppercase;">${title} (${fy})</h2>
                </center>
                <table class="report-table">
                    <thead><tr><th>S.N</th><th>Date</th><th>Particulars</th><th>Amount (‚Çπ)</th></tr></thead>
                    <tbody>${rows}</tbody>
                    <tfoot>
                        <tr style="font-weight:bold; background:#eee;">
                            <td colspan="3" style="text-align:right;">GRAND TOTAL:</td>
                            <td>‚Çπ ${total.toLocaleString()}</td>
                        </tr>
                    </tfoot>
                </table>
                <div style="display:flex; justify-content:space-between; margin-top:80px;">
                    <div style="text-align:center;"><div style="border-top:1px solid #000; width:150px; padding-top:5px;">Asst. Treasurer</div></div>
                    <div style="text-align:center;"><div style="border-top:1px solid #000; width:150px; padding-top:5px;">Principal Treasurer</div></div>
                </div>
            </div>`;
        window.print();
    }

    (function init() {
        const s = document.getElementById('yearFilter');
        for (let y = 2026; y <= 2035; y++) {
            let o = document.createElement('option'); o.value = y; o.text = "Session " + y;
            if(y === 2026) o.selected = true; s.appendChild(o);
        }
        document.getElementById('eDate').valueAsDate = new Date();
    })();
</script>
</body>
</html>
