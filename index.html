<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOK - Master Edition 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root { --navy: #060b26; --gold: #b8860b; }
        body { font-family: 'Inter', sans-serif; background: #020512; margin: 0; padding: 10px; color: #333; display: flex; justify-content: center; }

        /* UI Styles (Screen par dikhne wala) */
        .premium-frame { width: 100%; max-width: 1000px; background: #fff; border-radius: 25px; padding: 20px; box-sizing: border-box; }
        .brand-header { text-align: center; margin-bottom: 20px; }
        .brand-header h1 { color: var(--navy); margin: 0; font-size: 28px; }
        .brand-header h2 { color: var(--gold); margin: 5px 0; font-size: 18px; }
        
        .executive-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .exec-card { border: 1px solid #ddd; padding: 10px; border-radius: 10px; text-align: center; }
        
        .entry-section { background: #f4f7f9; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; }
        .btn-save { background: var(--navy); color: #fff; border: none; padding: 12px; border-radius: 8px; width: 100%; margin-top: 10px; cursor: pointer; font-weight: bold; }

        .stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .card { flex: 1; padding: 15px; border-radius: 15px; color: #fff; text-align: center; font-size: 12px; }
        .bg-blue { background: #060b26; } .bg-red { background: #7f1d1d; } .bg-green { background: #064e3b; }

        .list-section { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 15px; margin-bottom: 15px; overflow-x: auto; }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-print { background: var(--navy); color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }

        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th { background: #f8f8f8; padding: 10px; text-align: left; font-size: 11px; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; font-weight: 600; }
        .act-btn { border: none; padding: 5px 8px; border-radius: 4px; color: #fff; font-size: 10px; cursor: pointer; }
        .btn-del { background: #f87171; } .btn-r { background: var(--gold); }

        /* --- üõ†Ô∏è MOBILE-FRIENDLY PRINTING --- */
        #printArea { display: none; }

        @media print {
            /* Hide UI completely */
            html, body { height: auto; background: #fff !important; }
            .no-print, .premium-frame { display: none !important; }

            /* Show Print Area */
            #printArea { 
                display: block !important; 
                width: 100% !important; 
                margin: 0 !important; 
                padding: 0 !important;
                visibility: visible !important;
            }

            .ledger-container { padding: 10mm; background: #fff; color: #000; }
            .ledger-border { border: 2px solid #000; padding: 15px; min-height: 250mm; }
            .print-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
            .print-table { width: 100%; border-collapse: collapse; border: 1px solid #000; }
            .print-table th, .print-table td { border: 1px solid #000; padding: 8px; font-size: 12px; color: #000; }
            .total-summary-print { margin-top: 15px; display: flex; justify-content: space-around; border: 2px solid #000; padding: 10px; background: #eee !important; -webkit-print-color-adjust: exact; }
            .signature-row { margin-top: 50px; display: flex; justify-content: space-between; }
            .sig-box-p { width: 180px; border-top: 1.5px solid #000; text-align: center; padding-top: 5px; font-weight: bold; }

            /* Receipt Section */
            .receipt-centered { padding: 20mm 10mm; }
            .receipt-card { border: 2px solid #000; width: 100%; padding: 10px; }
            .receipt-inner { border: 4px double #000; padding: 15px; }
            .amt-box { border: 2px solid #000; padding: 8px; font-size: 18px; font-weight: bold; margin: 10px 0; display: inline-block; }
        }
    </style>
</head>
<body>

<div class="premium-frame no-print">
    <div class="brand-header">
        <h1>TREASURE BOOK</h1>
        <h2>B.B.C MARANG BUNDU</h2>
        <p style="font-size:12px;">Reg.no :- MBJ8750 - 13 Of 2022</p>
    </div>
    
    <div class="executive-info">
        <div class="exec-card"><span style="font-size:10px;">Principal Treasurer</span><b id="tName">...</b></div>
        <div class="exec-card"><span style="font-size:10px;">Asst Treasurer</span><b id="atName">...</b></div>
    </div>

    <div class="entry-section">
        <div class="form-grid">
            <select id="eType" onchange="handleFormChange()"><option value="donation">CREDIT</option><option value="expense">DEBIT</option></select>
            <input type="date" id="eDate">
            <input type="text" id="eName" placeholder="Full Name / Particulars">
            <select id="eOcc"><option value="">Occupation</option><option value="Teacher">Teacher</option><option value="Police">Police</option><option value="Army">Army</option><option value="Farmer">Farmer</option><option value="Student">Student</option><option value="Other">Other</option></select>
            <input type="number" id="eAmount" placeholder="Amount ‚Çπ">
        </div>
        <button class="btn-save" onclick="saveEntry()">CONFIRM TRANSACTION</button>
    </div>

    <div class="stats">
        <div class="card bg-blue">COLLECTION <br><b id="sumIn">0</b></div>
        <div class="card bg-red">EXPENSE <br><b id="sumOut">0</b></div>
        <div class="card bg-green">BALANCE <br><b id="sumBal">0</b></div>
    </div>

    <div class="list-section">
        <div class="list-header"><b>üí∞ CREDIT LEDGER</b> <button class="btn-print" onclick="printReport('don')">‚éô Print</button></div>
        <table id="tblDon"><thead><tr><th>Date</th><th>Name</th><th>Occ</th><th>Amt</th><th>X</th></tr></thead><tbody id="bodyDon"></tbody></table>
    </div>

    <div class="list-section">
        <div class="list-header"><b>üìâ DEBIT LEDGER</b> <button class="btn-print" onclick="printReport('exp')">‚éô Print</button></div>
        <table id="tblExp"><thead><tr><th>Date</th><th>Particulars</th><th>Amt</th><th>X</th></tr></thead><tbody id="bodyExp"></tbody></table>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };
    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database();
    let currentData = { donations: {}, expenses: {} };

    function formatDate(d) { if(!d) return "-"; const [y, m, d1] = d.split('-'); return `${d1}/${m}/${y}`; }

    dbRef.ref().on('value', (snap) => {
        const val = snap.val() || {};
        currentData.donations = val.donations || {};
        currentData.expenses = val.expenses || {};
        document.getElementById('tName').innerText = val.config?.tName || "Treasurer";
        document.getElementById('atName').innerText = val.config?.atName || "Asst Treasurer";
        loadView();
    });

    function loadView() {
        let bD = document.getElementById('bodyDon'), bE = document.getElementById('bodyExp');
        let tIn = 0, tOut = 0; bD.innerHTML = ''; bE.innerHTML = '';
        
        Object.entries(currentData.donations).forEach(([k, x]) => {
            bD.innerHTML += `<tr><td>${formatDate(x.date)}</td><td>${x.name}</td><td>${x.occ}</td><td>‚Çπ${x.amt}</td><td><button class="act-btn btn-del" onclick="deleteEntry('don', '${k}')">X</button></td></tr>`;
            tIn += x.amt;
        });
        Object.entries(currentData.expenses).forEach(([k, x]) => {
            bE.innerHTML += `<tr><td>${formatDate(x.date)}</td><td>${x.name}</td><td>‚Çπ${x.amt}</td><td><button class="act-btn btn-del" onclick="deleteEntry('exp', '${k}')">X</button></td></tr>`;
            tOut += x.amt;
        });
        document.getElementById('sumIn').innerText = tIn; document.getElementById('sumOut').innerText = tOut; document.getElementById('sumBal').innerText = (tIn - tOut);
    }

    function saveEntry() {
        const type = document.getElementById('eType').value, date = document.getElementById('eDate').value, name = document.getElementById('eName').value, amt = parseFloat(document.getElementById('eAmount').value), occ = document.getElementById('eOcc').value;
        if(!date || !name || isNaN(amt)) return alert("Data bhariye!");
        dbRef.ref(type === 'donation' ? 'donations/' : 'expenses/').push({ date, name, occ, amt, year: new Date(date).getFullYear() });
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = '';
    }

    function deleteEntry(t, k) { if(confirm("Delete?")) dbRef.ref((t==='don'?'donations/':'expenses/')+k).remove(); }

    function printReport(type) {
        const title = type === 'don' ? "CREDIT LEDGER" : "DEBIT LEDGER";
        let rows = ""; let data = type === 'don' ? currentData.donations : currentData.expenses;
        Object.values(data).forEach((x, i) => { 
            rows += `<tr><td>${i+1}</td><td>${formatDate(x.date)}</td><td>${x.name}</td>${type==='don'?`<td>${x.occ}</td>`:''}<td>‚Çπ${x.amt}</td></tr>`; 
        });

        document.getElementById('printArea').innerHTML = `
        <div class="ledger-container"><div class="ledger-border">
            <div class="print-header"><h1>B.B.C MARANG BUNDU</h1><h3>${title}</h3></div>
            <table class="print-table">
                <thead>${type==='don'?'<tr><th>Sl</th><th>Date</th><th>Name</th><th>Occ</th><th>Amt</th></tr>':'<tr><th>Sl</th><th>Date</th><th>Particulars</th><th>Amt</th></tr>'}</thead>
                <tbody>${rows}</tbody>
            </table>
            <div class="total-summary-print"><b>COLLECTION: ‚Çπ${document.getElementById('sumIn').innerText}</b> | <b>EXPENSE: ‚Çπ${document.getElementById('sumOut').innerText}</b> | <b>BALANCE: ‚Çπ${document.getElementById('sumBal').innerText}</b></div>
            <div class="signature-row"><div class="sig-box-p">General Secretary</div><div class="sig-box-p">Principal Treasurer</div></div>
        </div></div>`;
        window.print();
    }

    function handleFormChange() { document.getElementById('eOcc').style.display = (document.getElementById('eType').value === 'donation' ? 'inline-block' : 'none'); }
    window.onload = () => { document.getElementById('eDate').valueAsDate = new Date(); handleFormChange(); };
</script>
</body>
    </html>
