<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOK - Desh ka Best Design</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Birthstone&family=Inter:wght@300;400;600;700;900&family=Playfair+Display:ital,wght@0,700;1,700&family=Dancing+Script:wght@600&display=swap');
        
        :root { 
            --navy: #060b26; --gold: #b8860b; --premium-gold: #ffd700; 
            --glass: rgba(255, 255, 255, 0.96); --neon-blue: #00d2ff;
        }
        
        body { 
            font-family: 'Inter', sans-serif; background: #020512;
            margin: 0; padding: 15px; color: #333; min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- DASHBOARD UI (No Changes as per Request) --- */
        .premium-frame {
            position: relative; width: 100%; max-width: 1100px; padding: 4px;
            background: linear-gradient(90deg, #060b26, #b8860b, #00d2ff, #b8860b, #060b26);
            background-size: 300% 300%; animation: glowRotate 8s linear infinite;
            border-radius: 40px; box-shadow: 0 0 50px rgba(184, 134, 11, 0.4);
        }
        @keyframes glowRotate { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        .container { 
            background: var(--glass); border-radius: 38px; padding: 45px; 
            position: relative; width: 100%; box-sizing: border-box;
            backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.5);
        }
        
        .year-control-nano {
            position: absolute; top: 12px; right: 20px;
            background: var(--navy); color: var(--premium-gold); padding: 2px 6px;
            border-radius: 4px; font-size: 8px; font-weight: 900;
            border: 1px solid var(--gold); display: flex; align-items: center; gap: 2px;
            z-index: 100;
        }
        .year-control-nano select { background: transparent; color: #fff; border: none; font-weight: 800; outline: none; cursor: pointer; font-size: 8px; padding: 0; }

        .brand-header { text-align: center; margin-bottom: 45px; }
        .brand-header h1 { color: var(--navy); font-size: 46px; font-weight: 900; letter-spacing: 8px; margin: 0; text-transform: uppercase; }
        .brand-header h2 { color: var(--gold); font-size: 26px; font-weight: 800; margin: 12px 0; letter-spacing: 4px; }
        .brand-header p { color: #444; font-size: 13px; font-weight: 700; margin: 0; background: rgba(184, 134, 11, 0.1); display: inline-block; padding: 6px 25px; border-radius: 30px; border: 1.5px solid rgba(184, 134, 11, 0.2); }

        .executive-info { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .exec-card { background: linear-gradient(145deg, #ffffff, #f1f5f9); padding: 20px; border-radius: 22px; border: 1.5px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; position: relative; box-shadow: 5px 5px 15px rgba(0,0,0,0.05); }
        .exec-card span { font-size: 10px; color: #64748b; font-weight: 900; text-transform: uppercase; margin-bottom: 8px; }
        .exec-card b { font-size: 18px; color: var(--navy); border-bottom: 3px solid var(--gold); padding: 0 10px; }
        .exec-edit { position: absolute; right: 15px; top: 15px; font-size: 10px; cursor: pointer; color: #ef4444; border: none; background: none; font-weight: 900; text-transform: uppercase; }

        .entry-section { background: #fdfdfd; padding: 30px; border-radius: 32px; border: 1px solid #edf2f7; margin-bottom: 40px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        input, select { padding: 14px; border: 2px solid #e2e8f0; border-radius: 15px; font-size: 14px; font-weight: 600; outline: none; }
        .btn-save-compact { background: var(--navy); color: white; border: none; border-radius: 15px; padding: 14px 45px; font-size: 15px; font-weight: 900; cursor: pointer; margin: 25px auto 0; display: block; transition: 0.3s; box-shadow: 0 10px 25px rgba(6, 11, 38, 0.3); }

        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 45px; }
        .card { padding: 22px; border-radius: 28px; color: white; text-align: center; font-weight: 900; font-size: 13px; }
        .bg-blue { background: linear-gradient(135deg, #060b26, #1a2a6c); border-bottom: 4px solid var(--neon-blue); }
        .bg-red { background: linear-gradient(135deg, #7f1d1d, #ef4444); border-bottom: 4px solid #fca5a5; }
        .bg-green { background: linear-gradient(135deg, #064e3b, #10b981); border-bottom: 4px solid #6ee7b7; }

        .list-section { background: white; border-radius: 35px; padding: 30px; border: 1.5px solid #f1f5f9; margin-bottom: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.04); }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f8fafc; padding-bottom: 15px; }
        .list-title { font-size: 15px; font-weight: 900; color: var(--navy); text-transform: uppercase; }
        .btn-print-icon { background: var(--navy); color: var(--premium-gold); border: 2px solid var(--gold); padding: 10px 20px; border-radius: 14px; cursor: pointer; font-size: 18px; transition: 0.3s; }

        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; color: #64748b; padding: 20px; text-align: left; font-size: 11px; text-transform: uppercase; font-weight: 900; }
        td { padding: 18px; border-bottom: 1px solid #f1f5f9; font-size: 14px; font-weight: 600; }

        .act-btn { border: none; padding: 10px 15px; border-radius: 12px; color: white; cursor: pointer; font-size: 11px; font-weight: 800; margin-right: 6px; }
        .btn-r { background: var(--gold); } .btn-edit { background: #38bdf8; } .btn-del { background: #f87171; }

        #printArea { display: none; }
        
        /* --- üöÄ THE BEST DESIGN PRINT STYLES --- */
        @media print {
            body * { visibility: hidden; background: white !important; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { 
                position: absolute; left: 0; top: 0; width: 100%; display: block !important; 
                background: white !important; height: auto !important; overflow: hidden !important;
            }
            .premium-frame, .no-print { display: none !important; }

            /* Professional Modern Ledger Design */
            .ledger-container { 
                padding: 10mm; min-height: 285mm; width: 100%; box-sizing: border-box; 
                background: white; display: flex; flex-direction: column; overflow: hidden; page-break-after: avoid; 
            }
            .ledger-border { 
                border: 1px solid #000; padding: 3px; flex-grow: 1; display: flex; flex-direction: column;
            }
            .ledger-inner-border {
                border: 4px double #000; padding: 20px; flex-grow: 1; display: flex; flex-direction: column; position: relative;
            }
            
            /* Professional Diagonal Audit Watermark */
            .ledger-watermark { 
                position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-35deg); 
                font-size: 55px; color: rgba(0,0,0,0.035) !important; font-weight: 900; z-index: 0; 
                white-space: nowrap; text-align: center; pointer-events: none; text-transform: uppercase; letter-spacing: 5px;
            }

            .print-header { text-align: center; border-bottom: 2.5px solid #000; margin-bottom: 20px; padding-bottom: 15px; position: relative; z-index: 1; }
            .print-header h1 { font-size: 32px; margin: 0; color: #000; text-transform: uppercase; letter-spacing: 4px; font-weight: 900; }
            .print-header h2 { font-size: 20px; margin: 8px 0; color: #000; font-weight: 800; }
            .print-header p { font-size: 13px; font-weight: 900; margin: 2px 0; color: #333; }
            .print-type-label { 
                font-size: 20px; font-weight: 900; margin: 15px 0; display: inline-block; 
                text-transform: uppercase; text-align: center; color: #fff; background: #000;
                padding: 5px 30px; letter-spacing: 2px;
            }
            
            .print-table { width: 100%; border-collapse: collapse; margin-top: 10px; position: relative; z-index: 2; flex-grow: 1; }
            .print-table th { background: #eee !important; color: #000 !important; padding: 12px; border: 1px solid #000; -webkit-print-color-adjust: exact; font-size: 12px; text-transform: uppercase; }
            .print-table td { border: 1px solid #000; padding: 10px; font-size: 13px; font-weight: 700; color: #000; }

            /* Professional Audit Summary Box */
            .total-summary-print { 
                margin-top: 30px; border: 2.5px solid #000; padding: 15px; 
                display: flex; justify-content: space-around; align-items: center;
                background: #f8f8f8 !important; -webkit-print-color-adjust: exact;
                position: relative; z-index: 2;
            }
            .summary-item { text-align: center; border-right: 1.5px solid #ccc; flex: 1; }
            .summary-item:last-child { border-right: none; }
            .summary-label { font-size: 12px; font-weight: 900; color: #444; display: block; margin-bottom: 5px; }
            .summary-value { font-size: 18px; font-weight: 900; color: #000; }

            /* Balanced Signature Section */
            .signature-section-ledger { 
                margin-top: auto; padding-top: 60px; padding-bottom: 20px; 
                display: flex; justify-content: space-between; align-items: flex-end; padding-left: 30px; padding-right: 30px;
                position: relative; z-index: 2;
            }
            .sig-box-ledger { text-align: center; width: 240px; }
            .sig-line-ledger { border-top: 2.5px solid #000; margin-top: 10px; padding-top: 8px; font-weight: 900; font-size: 14px; text-transform: uppercase; }

            /* Receipt Styles (Maintained Premium Design) */
            .receipt-centered { display: flex; align-items: center; justify-content: center; min-height: 100vh; width: 100%; page-break-inside: avoid; }
            .receipt-card { border: 2.5px solid #000; padding: 5px; width: 700px; background: #fff; position: relative; overflow: hidden; }
            .receipt-inner-border { border: 6px double #000; padding: 40px; position: relative; }
            .receipt-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-35deg); font-size: 55px; color: rgba(0,0,0,0.035); font-weight: 900; z-index: 0; white-space: nowrap; }
            .receipt-title-box { border: 2px solid #000; display: inline-block; padding: 6px 35px; font-weight: 900; font-size: 20px; text-transform: uppercase; background: #fff; z-index: 2; letter-spacing: 2px;}
            .data-row { display: flex; margin-bottom: 15px; border-bottom: 1.5px dotted #000; padding-bottom: 6px; z-index: 2; position: relative; }
            .data-label { font-weight: 800; min-width: 170px; font-size: 15px; text-transform: uppercase; }
            .data-value { font-family: 'Playfair Display', serif; font-size: 21px; font-weight: 700; flex-grow: 1; }
            .amt-box-royal { background: #1a1a1a !important; color: #fff !important; padding: 12px 35px; font-size: 28px; font-weight: 900; border-radius: 10px; display: inline-block; -webkit-print-color-adjust: exact; border: 3px solid #000; margin-top: 10px;}
            .amt-words-row { margin-top: 20px; padding: 10px; background: #f6f6f6 !important; border-left: 8px solid #000; font-family: 'Playfair Display', serif; font-style: italic; -webkit-print-color-adjust: exact; font-size: 18px; }
            .official-signature-pen { font-family: 'Dancing Script', cursive; font-size: 45px; color: #081c5e !important; display: block; margin-bottom: -15px; transform: rotate(-2deg); font-weight: 600; -webkit-print-color-adjust: exact; }
            .sig-line-royal { border-top: 2.5px solid #000; width: 250px; margin-left: auto; padding-top: 10px; font-weight: 900; font-size: 14px; text-align: center; text-transform: uppercase; }
        }
    </style>
</head>
<body>

<div class="premium-frame no-print">
    <div class="container">
        <div class="year-control-nano">YR <select id="yearFilter" onchange="loadView()"></select></div>

        <div class="brand-header">
            <h1>TREASURE BOOK</h1>
            <h2>B.B.C MARANG BUNDU</h2>
            <p>Reg.no :- MBJ8750 - 13 Of 2022</p>
        </div>
        
        <div class="executive-info">
            <div class="exec-card"><span>Principal Treasurer</span><b id="tName">...</b><button class="exec-edit" onclick="editMember('tName', 'tName')">Edit</button></div>
            <div class="exec-card"><span>Assistant Treasurer</span><b id="atName">...</b><button class="exec-edit" onclick="editMember('atName', 'atName')">Edit</button></div>
        </div>

        <div class="entry-section">
            <div class="form-grid">
                <input type="hidden" id="editKey"><input type="hidden" id="editType">
                <select id="eType" onchange="handleFormChange()"><option value="donation">CREDIT (Collection)</option><option value="expense">DEBIT (Expenditure)</option></select>
                <input type="date" id="eDate">
                <input type="text" id="eName" placeholder="Name or Detail">
                <select id="eOcc" onchange="checkExService()">
                    <option value="">Occupation</option>
                    <option value="Teacher">Teacher</option><option value="Police">Police</option><option value="Army">Army</option>
                    <option value="Navy">Navy</option><option value="Air Force">Air Force</option><option value="BSF">BSF</option>
                    <option value="CRPF">CRPF</option><option value="CISF">CISF</option><option value="ITBP">ITBP</option>
                    <option value="SSB">SSB</option><option value="Railway">Railway</option><option value="Student">Student</option>
                    <option value="Farmer">Farmer</option><option value="Business">Business</option><option value="Social Worker">Social Worker</option>
                    <option value="Ex-Service">Ex-Service</option><option value="Other">Other</option>
                </select>
                <select id="eSubOcc" style="display:none;">
                    <option value="">Branch List</option>
                    <option value="Army">Army</option><option value="Navy">Navy</option><option value="Air Force">Air Force</option>
                    <option value="Police">Police</option><option value="BSF">BSF</option><option value="CRPF">CRPF</option>
                    <option value="CISF">CISF</option><option value="ITBP">ITBP</option><option value="SSB">SSB</option>
                    <option value="Railway">Railway</option><option value="Teacher">Teacher</option><option value="Govt Service">Govt Service</option>
                </select>
                <input type="text" id="eRecBy" placeholder="Received By (Optional)" style="display:none;">
                <input type="number" id="eAmount" placeholder="Amount ‚Çπ">
            </div>
            <button class="btn-save-compact" id="saveBtn" onclick="saveEntry()">CONFIRM TRANSACTION</button>
        </div>

        <div class="stats">
            <div class="card bg-blue">COLLECTION <br><b id="sumIn">0</b></div>
            <div class="card bg-red">EXPENDITURE <br><b id="sumOut">0</b></div>
            <div class="card bg-green">NET BALANCE <br><b id="sumBal">0</b></div>
        </div>

        <div class="list-section">
            <div class="list-header"><div class="list-title">üí∞ CREDIT LEDGER</div><button class="btn-print-icon" onclick="printReport('don')">‚éô</button></div>
            <table id="tblDon"><thead><tr><th>Sl</th><th>Date</th><th>Donor Name</th><th>Occupation</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyDon"></tbody></table>
        </div>

        <div class="list-section">
            <div class="list-header"><div class="list-title">üìâ DEBIT LEDGER</div><button class="btn-print-icon" onclick="printReport('exp')">‚éô</button></div>
            <table id="tblExp"><thead><tr><th>Sl</th><th>Date</th><th>Particulars</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyExp"></tbody></table>
        </div>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };

    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database();
    let currentData = { donations: {}, expenses: {} };

    function formatDate(dateStr) {
        if(!dateStr) return "-";
        const [y, m, d] = dateStr.split('-');
        return `${d}-${m}-${y}`;
    }

    function numberToWords(num) {
        const a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        if ((num = num.toString()).length > 9) return 'Overflow';
        let n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
        if (!n) return '';
        let str = '';
        str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
        str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
        str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
        str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
        str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only' : '';
        return str.trim();
    }

    function getSahidYear(year) {
        let count = parseInt(year) - 1974;
        let suffix = (count % 10 == 1 && count != 11) ? "st" : (count % 10 == 2 && count != 12) ? "nd" : (count % 10 == 3 && count != 13) ? "rd" : "th";
        return `${count}${suffix} SAHID DIWAS ${year}`;
    }

    dbRef.ref().on('value', (snap) => {
        const val = snap.val() || {};
        currentData.donations = val.donations || {};
        currentData.expenses = val.expenses || {};
        document.getElementById('tName').innerText = val.config?.tName || "Principal Treasurer";
        document.getElementById('atName').innerText = val.config?.atName || "Asst Treasurer";
        loadView();
    });

    function loadView() {
        const fYear = document.getElementById('yearFilter').value;
        let bDon = document.getElementById('bodyDon'), bExp = document.getElementById('bodyExp');
        let tIn = 0, tOut = 0; bDon.innerHTML = ''; bExp.innerHTML = '';
        let slDon = 1, slExp = 1;
        const sortedDon = Object.entries(currentData.donations).sort((a,b) => new Date(a[1].date) - new Date(b[1].date));
        sortedDon.forEach(([k, x]) => { if(x.year == fYear) { bDon.innerHTML += `<tr><td>${slDon++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td><td>${x.occ}</td><td>‚Çπ${x.amt.toLocaleString()}</td><td><button class="act-btn btn-r" onclick="printReceipt('${k}')">Bill</button><button class="act-btn btn-edit" onclick="editEntry('don', '${k}')">E</button><button class="act-btn btn-del" onclick="deleteEntry('don', '${k}')">X</button></td></tr>`; tIn += x.amt; } });
        const sortedExp = Object.entries(currentData.expenses).sort((a,b) => new Date(a[1].date) - new Date(b[1].date));
        sortedExp.forEach(([k, x]) => { if(x.year == fYear) { bExp.innerHTML += `<tr><td>${slExp++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td><td>‚Çπ${x.amt.toLocaleString()}</td><td><button class="act-btn btn-edit" onclick="editEntry('exp', '${k}')">E</button><button class="act-btn btn-del" onclick="deleteEntry('exp', '${k}')">X</button></td></tr>`; tOut += x.amt; } });
        document.getElementById('sumIn').innerText = tIn.toLocaleString(); document.getElementById('sumOut').innerText = tOut.toLocaleString(); document.getElementById('sumBal').innerText = (tIn - tOut).toLocaleString();
    }

    function handleFormChange() {
        const type = document.getElementById('eType').value;
        document.getElementById('eOcc').style.display = (type === 'donation') ? "inline-block" : "none";
        document.getElementById('eRecBy').style.display = (type === 'donation') ? "inline-block" : "none";
        checkExService();
    }

    function saveEntry() {
        const type = document.getElementById('eType').value, date = document.getElementById('eDate').value, name = document.getElementById('eName').value, amt = parseFloat(document.getElementById('eAmount').value), editKey = document.getElementById('editKey').value, occ = document.getElementById('eOcc').value;
        let recBy = document.getElementById('eRecBy').value;
        if(!date || !name || isNaN(amt)) return alert("Data bharein!");
        if(type === 'donation' && !recBy) recBy = document.getElementById('tName').innerText;
        let finalOcc = (occ === "Ex-Service") ? "Ex-Service (" + document.getElementById('eSubOcc').value + ")" : (occ || "-");
        const entry = { date, name, occ: (type==='donation'?finalOcc:'-'), amt, recBy: (type==='donation'?recBy:''), year: new Date(date).getFullYear() };
        if(editKey) dbRef.ref((document.getElementById('editType').value === 'donation' ? 'donations/' : 'expenses/') + editKey).remove();
        dbRef.ref((type === 'donation' ? 'donations/' : 'expenses/')).push(entry);
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = ''; document.getElementById('editKey').value = ''; document.getElementById('eRecBy').value = '';
    }

    function editEntry(type, key) {
        const item = type === 'don' ? currentData.donations[key] : currentData.expenses[key];
        document.getElementById('eType').value = type === 'don' ? 'donation' : 'expense'; document.getElementById('eDate').value = item.date; document.getElementById('eName').value = item.name; document.getElementById('eAmount').value = item.amt; document.getElementById('editKey').value = key; document.getElementById('editType').value = type === 'don' ? 'donation' : 'expense';
        if(type==='don') document.getElementById('eRecBy').value = item.recBy || '';
        document.getElementById('saveBtn').innerText = "UPDATE NOW"; handleFormChange(); window.scrollTo(0,0);
    }

    function deleteEntry(type, key) { if(confirm("Permanently Delete?")) dbRef.ref((type === 'don' ? 'donations/' : 'expenses/') + key).remove(); }

    function printReceipt(key) {
        const item = currentData.donations[key], trName = document.getElementById('tName').innerText;
        const amtWords = numberToWords(item.amt);
        document.getElementById('printArea').innerHTML = `
        <div class="receipt-centered">
            <div class="receipt-card">
                <div class="receipt-inner-border">
                    <div class="receipt-watermark">OFFICIAL AUDIT RECEIPT</div>
                    <div class="print-header"><h1>${getSahidYear(item.year)}</h1><h2>B.B.C MARANG BUNDU</h2><p>Reg.no :- MBJ8750 - 13 Of 2022</p><br><div class="receipt-title-box">DONATION RECEIPT</div></div>
                    <div style="margin-top:35px; position:relative; z-index:2;">
                        <div class="data-row"><span class="data-label">Donor Name:</span><span class="data-value">${item.name}</span></div>
                        <div class="data-row"><span class="data-label">Occupation:</span><span class="data-value">${item.occ}</span></div>
                        <div class="data-row"><span class="data-label">Date:</span><span class="data-value">${formatDate(item.date)}</span></div>
                        <div class="amt-words-row">Rupees ${amtWords}</div>
                        <div style="text-align:center; margin-top:20px;"><div class="amt-box-royal">‚Çπ ${item.amt.toLocaleString()} /-</div></div>
                    </div>
                    <div class="thank-you-note">"Aapka ye yogdaan hamari samiti ke liye atyant mahatvapurn hai. Sahid Diwas samaroh ko safal banane mein aapki sahayata ke liye hum aapke sadaiv abhari rahenge."<br><br><strong>üôè Thank You for Your Contribution!</strong></div>
                    <div style="text-align:right; margin-top:40px;"><span class="official-signature-pen">${trName}</span><div class="sig-line-royal">Principal Treasurer</div><div style="font-size:11px; font-weight:900; margin-top:5px; margin-right: 50px;">DATE: ${formatDate(item.date)}</div></div>
                </div>
            </div>
        </div>`;
        window.print();
    }

    function printReport(type) {
        const year = document.getElementById('yearFilter').value;
        const reportTitle = type === 'don' ? "OFFICIAL DONATIONS REPORT" : "OFFICIAL EXPENDITURE REPORT";
        let rows = ""; let sl = 1; let data = type === 'don' ? currentData.donations : currentData.expenses;
        Object.values(data).filter(x => x.year == year).sort((a,b) => new Date(a.date) - new Date(b.date)).forEach(x => { 
            rows += `<tr><td>${sl++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td>${type==='don'?`<td>${x.occ}</td><td>${x.recBy || document.getElementById('tName').innerText}</td>`:''}<td>‚Çπ${x.amt.toLocaleString()}</td></tr>`; 
        });
        const sIn = document.getElementById('sumIn').innerText, sOut = document.getElementById('sumOut').innerText, sBal = document.getElementById('sumBal').innerText;
        document.getElementById('printArea').innerHTML = `
        <div class="ledger-container">
            <div class="ledger-border">
                <div class="ledger-inner-border">
                    <div class="ledger-watermark">${reportTitle}</div>
                    <div class="print-header"><h1>${getSahidYear(year)}</h1><h2>B.B.C MARANG BUNDU</h2><p>Reg.no :- MBJ8750 - 13 Of 2022</p>
                    <span class="print-type-label">${reportTitle}</span></div>
                    <table class="print-table">
                        <thead>${type==='don'?'<tr><th>Sl</th><th>Date</th><th>Donor Name</th><th>Occupation</th><th>Received By</th><th>Amount</th></tr>':'<tr><th>Sl</th><th>Date</th><th>Particulars</th><th>Amount</th></tr>'}</thead>
                        <tbody>${rows}</tbody>
                    </table>
                    <div class="total-summary-print">
                        <div class="summary-item"><span class="summary-label">TOTAL COLLECTION</span><span class="summary-value">‚Çπ ${sIn}</span></div>
                        <div class="summary-item"><span class="summary-label">TOTAL EXPENDITURE</span><span class="summary-value">‚Çπ ${sOut}</span></div>
                        <div class="summary-item"><span class="summary-label">NET BALANCE</span><span class="summary-value">‚Çπ ${sBal}</span></div>
                    </div>
                    <div class="signature-section-ledger">
                        <div class="sig-box-ledger"><div class="sig-line-ledger">General Secretary</div></div>
                        <div class="sig-box-ledger"><span class="official-signature-pen" style="font-size:32px;">${document.getElementById('tName').innerText}</span><div class="sig-line-ledger">Principal Treasurer</div></div>
                    </div>
                </div>
            </div>
        </div>`;
        window.print();
    }

    function buildYearDropdown() { const sel = document.getElementById('yearFilter'); for (let y = 2024; y <= 2050; y++) { let opt = document.createElement('option'); opt.value = y; opt.text = y; if(y === new Date().getFullYear()) opt.selected = true; sel.appendChild(opt); } }
    function editMember(elId, field) { let v = prompt("Official Full Name:", document.getElementById(elId).innerText); if(v) dbRef.ref('config/' + field).set(v); }
    function checkExService() { document.getElementById('eSubOcc').style.display = (document.getElementById('eOcc').value === "Ex-Service") ? "inline-block" : "none"; }
    function handleFormChange() { document.getElementById('eOcc').style.display = (document.getElementById('eType').value === 'donation') ? "inline-block" : "none"; document.getElementById('eRecBy').style.display = (document.getElementById('eType').value === 'donation') ? "inline-block" : "none"; checkExService(); }
    window.onload = () => { buildYearDropdown(); document.getElementById('eDate').valueAsDate = new Date(); handleFormChange(); };
</script>
</body>
</html>
