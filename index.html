<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOKS | ELITE SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Outfit:wght@300;400;600;900&family=Dancing+Script:wght@700&family=Crimson+Text:ital,wght@1,600&display=swap');

        :root {
            --bg: #05080a; --glass: rgba(15, 23, 42, 0.7);
            --gold: #eab308; --neon-teal: #06b6d4;
            --green: #10b981; --red: #f43f5e; --border: rgba(255, 255, 255, 0.08);
        }

        body { margin: 0; font-family: 'Outfit', sans-serif; background: radial-gradient(circle at top right, #082f49, #05080a); color: #f8fafc; min-height: 100vh; }

        /* --- DASHBOARD UI --- */
        .year-mini-pin { position: fixed; top: 15px; right: 15px; z-index: 1001; background: rgba(6, 182, 212, 0.2); backdrop-filter: blur(10px); border: 1px solid var(--neon-teal); padding: 4px 8px; border-radius: 8px; display: flex; align-items: center; gap: 5px; box-shadow: 0 0 10px var(--neon-teal); }
        .year-mini-pin select { background: transparent; border: none; color: #fff; font-weight: 800; outline: none; cursor: pointer; font-size: 11px; }
        .dash-header { text-align: center; padding: 40px 20px 10px; }
        .main-title { font-family: 'Cinzel', serif; font-size: 48px; font-weight: 900; letter-spacing: 6px; margin: 0; background: linear-gradient(to bottom, #fff, #64748b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sub-title { font-family: 'Cinzel', serif; font-size: 20px; color: var(--gold); margin: 8px 0; }
        .reg-no { font-size: 11px; color: var(--neon-teal); letter-spacing: 3px; font-weight: 900; opacity: 0.8; }
        
        /* TREASURER HUB */
        .treasurer-config { display: flex; justify-content: center; gap: 15px; margin: 20px auto; }
        .t-box { background: var(--glass); border: 1px solid var(--border); padding: 10px 15px; border-radius: 12px; text-align: center; }
        .t-box label { font-size: 9px; color: var(--neon-teal); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .t-box input { background: transparent; border: none; border-bottom: 1px solid #334155; color: #fff; text-align: center; font-family: 'Cinzel'; font-weight: 900; font-size: 13px; outline: none; width: 160px; }
        
        .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 1100px; margin: 0 auto 30px; width: 95%; }
        .stat-card { background: var(--glass); padding: 25px; border-radius: 24px; border: 1px solid var(--border); text-align: center; }
        .stat-val { font-size: 32px; font-weight: 900; font-family: 'Cinzel'; margin-top: 8px; }
        
        .form-box { background: #0f172a; padding: 30px; border-radius: 30px; border: 1px solid var(--border); max-width: 800px; margin: 20px auto; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 15px; }
        .form-grid input, .form-grid select { background: #1e293b; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 12px; outline: none; }
        .btn-save { grid-column: span 3; background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        
        .lists-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1300px; margin: 30px auto; padding: 0 20px; }
        .ledger-box { background: var(--glass); padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; color: #64748b; padding: 10px; border-bottom: 2px solid var(--border); }
        td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.02); }
        .btn-mini { padding: 6px 10px; border-radius: 6px; cursor: pointer; border: 1px solid #334155; background: #000; color: #fff; font-size: 10px; margin-right: 3px; }

        /* --- MODAL FOR EDITING --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; }
        .modal-content { background: #0f172a; padding: 30px; border-radius: 20px; border: 1px solid var(--gold); width: 350px; }

        /* --- PRINT DESIGNS --- */
        #printArea { display: none; }
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { display: block !important; position: absolute; left: 0; top: 0; width: 100%; background: white; color: black; padding: 5mm; }

            .perfect-receipt { border: 8px double #000; padding: 30px 45px; margin: auto; background: #fff; box-sizing: border-box; position: relative; }
            .header-section { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; }
            .print-h1 { font-family: 'Cinzel'; font-size: 42px; margin: 0; font-weight: 900; }
            .sig-font { font-family: 'Dancing Script', cursive; font-size: 45px; display: block; }
            .report-border-single { border: 2px solid #000; padding: 25px; box-sizing: border-box; }
            .summary-strip { display: flex; justify-content: space-between; border: 2.5px solid black; background: #f2f2f2 !important; -webkit-print-color-adjust: exact; font-weight: 900; margin-top: 10px; padding: 12px; font-size: 14px; }
        }
    </style>
</head>
<body>

<div class="year-mini-pin no-print">
    <select id="yearFilter" onchange="loadView()"></select>
</div>

<div class="dash-header no-print">
    <h1 class="main-title">TREASURE BOOKS</h1>
    <div class="sub-title">B.B.C MARANG BUNDU</div>
    <div class="reg-no">Reg.no :- MBJ8750 - 13 Of 2022</div>
</div>

<div class="treasurer-config no-print">
    <div class="t-box"><label>Principal Treasurer</label><input type="text" id="cfgT" placeholder="Enter Name" onchange="updateCfg()"></div>
    <div class="t-box"><label>Assistant Treasurer</label><input type="text" id="cfgAT" placeholder="Enter Name" onchange="updateCfg()"></div>
</div>

<div class="stats-container no-print">
    <div class="stat-card"><div style="color:var(--green)">COLLECTIONS</div><div class="stat-val" id="sumIn">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--red)">EXPENDITURES</div><div class="stat-val" id="sumOut">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--gold)">CASH BALANCE</div><div class="stat-val" id="sumBal">‚Çπ 0</div></div>
</div>

<div class="form-box no-print">
    <div class="form-grid">
        <select id="eType" style="grid-column: span 3;"><option value="donation">CREDIT (Collection)</option><option value="expense">DEBIT (Expenditure)</option></select>
        <input type="date" id="eDate">
        <input type="number" id="eAmount" placeholder="Amount ‚Çπ">
        <input type="text" id="eName" placeholder="Donor Name / Purpose">
        <button class="btn-save" onclick="saveEntry()">Commit Transaction</button>
    </div>
</div>

<div class="lists-container no-print">
    <div class="ledger-box">
        <h3 style="color:var(--green); display:flex; justify-content:space-between;">Collections <button class="btn-mini" onclick="printReport('don')">Report</button></h3>
        <table><thead><tr><th>Date</th><th>Donor</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyDon"></tbody></table>
    </div>
    <div class="ledger-box">
        <h3 style="color:var(--red); display:flex; justify-content:space-between;">Expenditures <button class="btn-mini" onclick="printReport('exp')">Report</button></h3>
        <table><thead><tr><th>Date</th><th>Purpose</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyExp"></tbody></table>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h3 style="color:var(--gold); margin-top:0;">‚úèÔ∏è Edit Entry</h3>
        <input type="hidden" id="editKey"><input type="hidden" id="editType">
        <div style="display:flex; flex-direction:column; gap:12px;">
            <input type="date" id="mDate"><input type="text" id="mName" placeholder="Name"><input type="number" id="mAmount" placeholder="Amount">
            <button class="btn-save" onclick="updateData()">Update Data</button>
            <button onclick="closeModal()" style="color:#94a3b8; background:none; border:none; cursor:pointer;">Cancel</button>
        </div>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let localData = { donations: {}, expenses: {}, config: { tName: "", atName: "" } };

    db.ref().on('value', snap => {
        const v = snap.val() || {};
        localData.donations = v.donations || {};
        localData.expenses = v.expenses || {};
        if(v.config) { localData.config = v.config; document.getElementById('cfgT').value = v.config.tName || ""; document.getElementById('cfgAT').value = v.config.atName || ""; }
        loadView();
    });

    function updateCfg() { db.ref('config').update({ tName: document.getElementById('cfgT').value, atName: document.getElementById('cfgAT').value }); }

    function numToWords(n) {
        const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
        const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        const format = (num) => {
            if (num == 0) return ''; if (num < 20) return a[num];
            if (num < 100) return b[Math.floor(num / 10)] + (num % 10 !== 0 ? ' ' + a[num % 10] : '');
            if (num < 1000) return a[Math.floor(num / 100)] + ' Hundred ' + (num % 100 !== 0 ? 'and ' + format(num % 100) : '');
            if (num < 100000) return format(Math.floor(num / 1000)) + ' Thousand ' + (num % 1000 !== 0 ? format(num % 1000) : '');
            if (num < 10000000) return format(Math.floor(num / 100000)) + ' Lakh ' + (num % 100000 !== 0 ? format(num % 100000) : '');
            return format(Math.floor(num / 10000000)) + ' Crore ' + (num % 10000000 !== 0 ? format(num % 10000000) : '');
        }
        return n == 0 ? 'Zero Only' : format(n) + 'Only';
    }

    function loadView() {
        const fy = document.getElementById('yearFilter').value;
        const bD = document.getElementById('bodyDon'), bE = document.getElementById('bodyExp');
        let tin = 0, tout = 0; bD.innerHTML = ''; bE.innerHTML = '';
        Object.entries(localData.donations).forEach(([k, x]) => {
            if(x.year == fy) { tin += Number(x.amt); bD.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="printReceipt('${k}')">Bill</button><button class="btn-mini" onclick="openEditModal('donation','${k}')">‚úèÔ∏è</button><button class="btn-mini" onclick="deleteEntry('donations','${k}')">üóëÔ∏è</button></td></tr>`; }
        });
        Object.entries(localData.expenses).forEach(([k, x]) => {
            if(x.year == fy) { tout += Number(x.amt); bE.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="openEditModal('expense','${k}')">‚úèÔ∏è</button><button class="btn-mini" onclick="deleteEntry('expenses','${k}')">üóëÔ∏è</button></td></tr>`; }
        });
        document.getElementById('sumIn').innerText = '‚Çπ ' + tin.toLocaleString(); document.getElementById('sumOut').innerText = '‚Çπ ' + tout.toLocaleString(); document.getElementById('sumBal').innerText = '‚Çπ ' + (tin - tout).toLocaleString();
    }

    function saveEntry() {
        const t = document.getElementById('eType').value, d = document.getElementById('eDate').value, n = document.getElementById('eName').value, a = document.getElementById('eAmount').value;
        if(!d || !n || !a) return alert("Pura data bharein!");
        db.ref(t === 'donation' ? 'donations/' : 'expenses/').push({ date: d, name: n, amt: Number(a), year: new Date(d).getFullYear() });
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = '';
    }

    function openEditModal(t, k) {
        const d = t === 'donation' ? localData.donations[k] : localData.expenses[k];
        document.getElementById('editKey').value = k; document.getElementById('editType').value = t;
        document.getElementById('mDate').value = d.date; document.getElementById('mName').value = d.name; document.getElementById('mAmount').value = d.amt;
        document.getElementById('editModal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('editModal').style.display = 'none'; }
    function updateData() {
        const k = document.getElementById('editKey').value, t = document.getElementById('editType').value;
        db.ref((t === 'donation' ? 'donations/' : 'expenses/') + k).update({ date: document.getElementById('mDate').value, name: document.getElementById('mName').value, amt: Number(document.getElementById('mAmount').value), year: new Date(document.getElementById('mDate').value).getFullYear() });
        closeModal();
    }

    function deleteEntry(p, k) { if(confirm("Delete?")) db.ref(p + '/' + k).remove(); }

    function printReceipt(key) {
        const item = localData.donations[key]; const words = numToWords(item.amt);
        const style = document.createElement('style'); style.innerHTML = "@page { size: landscape; margin: 0; }"; document.head.appendChild(style);
        document.getElementById('printArea').innerHTML = `<div class="perfect-receipt" style="width:260mm; min-height:165mm;">
            <div class="header-section">
                <div class="print-h1">52nd SAHID DIWAS 2026</div><div class="print-h2">B.B.C MARANG BUNDU</div><div class="reg-line">Reg.no :- MBJ8750 - 13 Of 2022</div><div class="label-pill-print">DONATION RECEIPT</div>
            </div>
            <div style="display:flex; justify-content:space-between; margin:25px 0; font-size:20px; font-weight:bold;">
                <span>Receipt No: <span class="ink-underline">#${key.substr(-5).toUpperCase()}</span></span><span>Date: <span class="ink-underline">${item.date}</span></span>
            </div>
            <div style="font-size:22px; line-height:2.8;">Received with thanks from Mr./Ms. <span class="ink-underline" style="min-width:450px;">${item.name}</span> <br>The sum of Rupees <span class="ink-underline" style="min-width:550px; text-transform:capitalize;">${words}</span> <br>Towards <span class="ink-underline" style="min-width:550px;">52nd Sahid Diwas Celebration Fund</span>.</div>
            <div style="text-align:center; margin:15px 0;"><div style="border:6px double #000; padding:15px 50px; font-size:42px; font-weight:900; background:#f2f2f2 !important; display:inline-block; -webkit-print-color-adjust: exact;">‚Çπ ${Number(item.amt).toLocaleString()} /-</div></div>
            <div style="margin-top:auto;"><div style="text-align:center; border-top:1px dashed #000; padding-top:15px;"><p style="font-style:italic; font-size:16px;">"Thank you for your contribution."</p><b style="font-size:22px; letter-spacing:5px;">THANK YOU!</b></div>
            <div style="display:flex; justify-content:flex-end; margin-top:20px;"><div style="text-align:center; width:300px;"><span class="sig-font">${localData.config.tName}</span><div style="border-top:2px solid #000; font-weight:900;">Principal Treasurer</div></div></div></div></div>`;
        window.print(); style.remove();
    }

    function printReport(type) {
        const fy = document.getElementById('yearFilter').value; let tin = 0, tout = 0;
        const style = document.createElement('style'); style.innerHTML = "@page { size: portrait; margin: 10mm; }"; document.head.appendChild(style);
        const rows = Object.values(type === 'don' ? localData.donations : localData.expenses).filter(x => x.year == fy).map((x, i) => `<tr><td>${i+1}</td><td>${x.date}</td><td>${x.name}</td><td>‚Çπ ${Number(x.amt).toLocaleString()}</td></tr>`).join('');
        Object.values(localData.donations).filter(x => x.year == fy).forEach(x => tin += Number(x.amt)); Object.values(localData.expenses).filter(x => x.year == fy).forEach(x => tout += Number(x.amt));
        document.getElementById('printArea').innerHTML = `<div class="report-border-single" style="width:100%;">
            <center><h1 class="print-h1">52nd SAHID DIWAS 2026</h1><h2 class="print-h2">B.B.C MARANG BUNDU</h2><div class="label-pill-print">${type === 'don' ? 'COLLECTION' : 'EXPENDITURE'} REPORT</div></center>
            <table style="width:100%; border-collapse:collapse; margin-top:20px;" border="1"><thead><tr style="background:#eee;"><th>S.N</th><th>Date</th><th>Particulars</th><th>Amount</th></tr></thead><tbody>${rows}</tbody></table>
            <div class="summary-strip"><div>COLLECTIONS: ‚Çπ${tin.toLocaleString()}</div><div>EXPENSES: ‚Çπ${tout.toLocaleString()}</div><div>BALANCE: ‚Çπ${(tin-tout).toLocaleString()}</div></div>
            <div style="display:flex; justify-content:space-between; margin-top:60px; padding:0 20px;"><div style="text-align:center;"><span class="sig-font">${localData.config.atName}</span><div style="border-top:1px solid #000;">Asst. Treasurer</div></div><div style="text-align:center;"><span class="sig-font">${localData.config.tName}</span><div style="border-top:1px solid #000;">Principal Treasurer</div></div></div></div>`;
        window.print(); style.remove();
    }

    (function init() {
        const s = document.getElementById('yearFilter');
        for (let y = 2026; y <= 2050; y++) {
            let o = document.createElement('option'); o.value = y; o.text = "Session " + y;
            if(y === 2026) o.selected = true; s.appendChild(o);
        }
        document.getElementById('eDate').valueAsDate = new Date();
    })();
</script>
</body>
</html>
