<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOKS | ELITE SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Outfit:wght@300;400;600;900&family=Dancing+Script:wght@700&family=Crimson+Text:ital,wght@1,600&display=swap');

        :root {
            --bg: #05080a; --glass: rgba(15, 23, 42, 0.85);
            --gold: #eab308; --neon-teal: #06b6d4;
            --green: #10b981; --red: #f43f5e; --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            margin: 0; font-family: 'Outfit', sans-serif; 
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1510511459019-5dee997dd1db?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #f8fafc; min-height: 100vh; 
        }

        /* --- DASHBOARD UI --- */
        .dash-header { text-align: center; padding: 40px 20px 10px; }
        .main-title { font-family: 'Cinzel', serif; font-size: 48px; font-weight: 900; letter-spacing: 6px; margin: 0; background: linear-gradient(to bottom, #fff, #64748b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sub-title { font-family: 'Cinzel', serif; font-size: 20px; color: var(--gold); margin: 8px 0; }
        .reg-no { font-size: 11px; color: var(--neon-teal); letter-spacing: 3px; font-weight: 900; opacity: 0.9; }

        .year-bg-pin { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--neon-teal); padding: 10px 30px; border-radius: 50px; width: fit-content; margin: 20px auto; backdrop-filter: blur(10px); display: flex; align-items: center; gap: 10px; }
        .year-bg-pin select { background: transparent; border: none; color: #fff; font-weight: 900; font-size: 16px; outline: none; cursor: pointer; }

        .treasurer-config { display: flex; justify-content: center; gap: 15px; margin: 20px auto; }
        .t-box { background: var(--glass); border: 1px solid var(--border); padding: 10px 15px; border-radius: 12px; text-align: center; }
        .t-box input { background: transparent; border: none; border-bottom: 1px solid #334155; color: #fff; text-align: center; font-family: 'Cinzel'; font-size: 13px; outline: none; width: 160px; }

        .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 1100px; margin: 0 auto 30px; width: 95%; }
        .stat-card { background: var(--glass); padding: 25px; border-radius: 24px; border: 1px solid var(--border); text-align: center; }
        .stat-val { font-size: 32px; font-weight: 900; font-family: 'Cinzel'; margin-top: 8px; }

        .form-box { background: var(--glass); padding: 30px; border-radius: 30px; border: 1px solid var(--border); max-width: 800px; margin: 20px auto; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 15px; }
        .form-grid input, .form-grid select { background: #1e293b; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 12px; outline: none; }
        .btn-save { grid-column: span 3; background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer; text-transform: uppercase; }

        .lists-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1300px; margin: 30px auto; padding: 0 20px; }
        .ledger-box { background: var(--glass); padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; color: #64748b; padding: 10px; border-bottom: 2px solid var(--border); }
        td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.02); }
        .btn-mini { padding: 6px 10px; border-radius: 6px; cursor: pointer; border: 1px solid #334155; background: #000; color: #fff; font-size: 10px; }

        /* --- PRINT DESIGNS --- */
        #printArea { display: none; }
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { display: block !important; position: absolute; left: 0; top: 0; width: 100%; background: white !important; color: black !important; }
            
            /* Professional Ledger Style */
            .report-wrapper { padding: 15mm; min-height: 280mm; display: flex; flex-direction: column; background: white; box-sizing: border-box; }
            .report-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .report-title { background: #000 !important; color: #fff !important; padding: 5px 30px; display: inline-block; font-weight: 900; -webkit-print-color-adjust: exact; margin: 10px 0; }
            
            .report-table { width: 100%; border-collapse: collapse; margin: 10px 0; border: 2.5px solid #000; }
            .report-table th { background: #f2f2f2 !important; -webkit-print-color-adjust: exact; border: 1.5px solid #000; padding: 10px; font-weight: 900; font-size: 14px; }
            .report-table td { border: 1px solid #000; padding: 10px; font-size: 14px; }
            
            .report-summary { display: grid; grid-template-columns: repeat(3, 1fr); border: 2.5px solid #000; border-top: none; background: #f9f9f9 !important; -webkit-print-color-adjust: exact; font-weight: 900; }
            .report-summary div { padding: 15px; text-align: center; border-right: 1px solid #000; }
            .report-summary div:last-child { border-right: none; }

            .report-sig-row { display: flex; justify-content: space-between; margin-top: auto; padding: 50px 20px 20px; }
            .sig-box-final { text-align: center; width: 220px; }
            .sig-font { font-family: 'Dancing Script', cursive; font-size: 40px; display: block; height: 45px; color: #000; }
            .sig-line { border-top: 2px solid #000; padding-top: 5px; font-weight: 900; font-size: 13px; text-transform: uppercase; }

            /* Receipt Logic - Middle Print */
            .landscape-receipt-wrap { height: 100vh; display: flex; align-items: center; justify-content: center; }
            .receipt-card { width: 250mm; height: 160mm; border: 8px double #000; padding: 40px; display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; }
            @page { margin: 0; }
            .portrait-page { size: portrait; }
            .landscape-page { size: landscape; }
        }
    </style>
</head>
<body>

<div class="dash-header no-print">
    <h1 class="main-title">TREASURE BOOKS</h1>
    <div class="sub-title">B.B.C MARANG BUNDU</div>
    <div class="reg-no">Reg.no :- MBJ8750 - 13 Of 2022</div>
</div>

<div class="year-bg-pin no-print">
    <select id="yearFilter" onchange="loadView()"></select>
</div>

<div class="treasurer-config no-print">
    <div class="t-box"><label style="font-size: 9px; color: var(--neon-teal);">PRINCIPAL TREASURER</label><br><input type="text" id="cfgT" onchange="updateCfg()"></div>
    <div class="t-box"><label style="font-size: 9px; color: var(--neon-teal);">ASST. TREASURER</label><br><input type="text" id="cfgAT" onchange="updateCfg()"></div>
</div>

<div class="stats-container no-print">
    <div class="stat-card"><div style="color:var(--green)">COLLECTIONS</div><div class="stat-val" id="sumIn">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--red)">EXPENDITURES</div><div class="stat-val" id="sumOut">‚Çπ 0</div></div>
    <div class="stat-card"><div style="color:var(--gold)">CASH BALANCE</div><div class="stat-val" id="sumBal">‚Çπ 0</div></div>
</div>

<div class="form-box no-print">
    <div class="form-grid">
        <select id="eType" style="grid-column: span 3;"><option value="donation">CREDIT (Collection)</option><option value="expense">DEBIT (Expenditure)</option></select>
        <input type="date" id="eDate">
        <input type="number" id="eAmount" placeholder="Amount ‚Çπ">
        <input type="text" id="eName" placeholder="Donor Name / Purpose">
        <button class="btn-save" onclick="saveEntry()">Save Transaction</button>
    </div>
</div>

<div class="lists-container no-print">
    <div class="ledger-box">
        <h3 style="color:var(--green); display:flex; justify-content:space-between;">Collections <button class="btn-mini" onclick="printReport('don')">Report</button></h3>
        <table><thead><tr><th>Date</th><th>Donor</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyDon"></tbody></table>
    </div>
    <div class="ledger-box">
        <h3 style="color:var(--red); display:flex; justify-content:space-between;">Expenditures <button class="btn-mini" onclick="printReport('exp')">Report</button></h3>
        <table><thead><tr><th>Date</th><th>Purpose</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyExp"></tbody></table>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let localData = { donations: {}, expenses: {}, config: { tName: "", atName: "" } };

    db.ref().on('value', snap => {
        const v = snap.val() || {};
        localData.donations = v.donations || {};
        localData.expenses = v.expenses || {};
        if(v.config) {
            localData.config = v.config;
            document.getElementById('cfgT').value = v.config.tName || "";
            document.getElementById('cfgAT').value = v.config.atName || "";
        }
        loadView();
    });

    function updateCfg() {
        db.ref('config').update({ tName: document.getElementById('cfgT').value, atName: document.getElementById('cfgAT').value });
    }

    function numToWords(n) {
        const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
        const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        const format = (num) => {
            if (num == 0) return '';
            if (num < 20) return a[num];
            if (num < 100) return b[Math.floor(num / 10)] + (num % 10 !== 0 ? ' ' + a[num % 10] : '');
            if (num < 1000) return a[Math.floor(num / 100)] + ' Hundred ' + (num % 100 !== 0 ? 'and ' + format(num % 100) : '');
            if (num < 100000) return format(Math.floor(num / 1000)) + ' Thousand ' + (num % 1000 !== 0 ? format(num % 1000) : '');
            if (num < 10000000) return format(Math.floor(num / 100000)) + ' Lakh ' + (num % 100000 !== 0 ? format(num % 100000) : '');
            return format(Math.floor(num / 10000000)) + ' Crore ' + (num % 10000000 !== 0 ? format(num % 10000000) : '');
        }
        return n == 0 ? 'Zero Only' : format(n) + 'Only';
    }

    function loadView() {
        const fy = document.getElementById('yearFilter').value;
        const bD = document.getElementById('bodyDon'), bE = document.getElementById('bodyExp');
        let tin = 0, tout = 0; bD.innerHTML = ''; bE.innerHTML = '';
        Object.entries(localData.donations).forEach(([k, x]) => {
            if(x.year == fy) { tin += Number(x.amt); bD.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="printReceipt('${k}')">Bill</button> <button class="btn-mini" onclick="deleteEntry('donations','${k}')">üóëÔ∏è</button></td></tr>`; }
        });
        Object.entries(localData.expenses).forEach(([k, x]) => {
            if(x.year == fy) { tout += Number(x.amt); bE.innerHTML += `<tr><td>${x.date}</td><td>${x.name}</td><td>‚Çπ${Number(x.amt).toLocaleString()}</td><td><button class="btn-mini" onclick="deleteEntry('expenses','${k}')">üóëÔ∏è</button></td></tr>`; }
        });
        document.getElementById('sumIn').innerText = '‚Çπ ' + tin.toLocaleString();
        document.getElementById('sumOut').innerText = '‚Çπ ' + tout.toLocaleString();
        document.getElementById('sumBal').innerText = '‚Çπ ' + (tin - tout).toLocaleString();
    }

    function saveEntry() {
        const t = document.getElementById('eType').value, d = document.getElementById('eDate').value, n = document.getElementById('eName').value, a = document.getElementById('eAmount').value;
        if(!d || !n || !a) return alert("Pura data bharein!");
        db.ref(t === 'donation' ? 'donations/' : 'expenses/').push({ date: d, name: n, amt: Number(a), year: new Date(d).getFullYear() });
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = '';
    }

    function deleteEntry(p, k) { if(confirm("Permanently Delete?")) db.ref(p + '/' + k).remove(); }

    function printReceipt(key) {
        const item = localData.donations[key];
        const words = numToWords(item.amt);
        const style = document.createElement('style');
        style.innerHTML = "@page { size: landscape; margin: 0; }";
        document.head.appendChild(style);

        document.getElementById('printArea').innerHTML = `
            <div class="landscape-receipt-wrap">
                <div class="receipt-card">
                    <center>
                        <h1 style="font-family:Cinzel; font-size:38px; margin:0;">52nd SAHID DIWAS 2026</h1>
                        <h2 style="font-family:Cinzel; font-size:24px; margin:5px 0;">B.B.C MARANG BUNDU</h2>
                        <div style="font-weight:bold; font-size:14px;">Reg.no :- MBJ8750 - 13 Of 2022</div>
                        <div class="label-pill">DONATION RECEIPT</div>
                    </center>
                    <div style="display:flex; justify-content:space-between; margin:20px 0; font-size:18px; font-weight:bold;">
                        <span>Receipt No: <span class="ink-field">#${key.substr(-5).toUpperCase()}</span></span>
                        <span>Date: <span class="ink-field">${item.date}</span></span>
                    </div>
                    <div style="font-size:20px; line-height:2.5; font-family:'Crimson Text', serif;">
                        Received with thanks from Mr./Ms. <span class="ink-field" style="min-width:400px; display:inline-block;">${item.name}</span> <br>
                        Amount in Words: <span class="ink-field" style="min-width:550px; text-transform:capitalize; display:inline-block;">${words}</span> <br>
                        Towards <span class="ink-field" style="min-width:550px; display:inline-block;">52nd Sahid Diwas Celebration Fund</span>.
                    </div>
                    <center><div style="border:6px double #000; padding:15px 50px; font-size:38px; font-weight:900; background:#f2f2f2 !important; display:inline-block; margin:20px 0; -webkit-print-color-adjust: exact;">‚Çπ ${Number(item.amt).toLocaleString()} /-</div></center>
                    <div style="text-align:center; border-top:1px dashed #000; padding-top:15px;">
                        <p style="font-style:italic; font-size:15px; margin:0;">"Aapka bahumulya yogdaan ke liye B.B.C Marang Bundu samiti sadaiv abhari rahegi."</p>
                        <b style="font-size:20px; letter-spacing:5px;">THANK YOU!</b>
                    </div>
                    <div style="display:flex; justify-content:flex-end;">
                        <div class="sig-box-final">
                            <span class="sig-font">${localData.config.tName}</span>
                            <div class="sig-line">Principal Treasurer</div>
                            <div style="font-size:11px; font-weight:bold;">B.B.C MARANG BUNDU</div>
                        </div>
                    </div>
                </div>
            </div>`;
        window.print();
        style.remove();
    }

    function printReport(type) {
        const fy = document.getElementById('yearFilter').value;
        let tin = 0, tout = 0;
        const style = document.createElement('style');
        style.innerHTML = "@page { size: portrait; margin: 10mm; }";
        document.head.appendChild(style);

        const rows = Object.values(type === 'don' ? localData.donations : localData.expenses).filter(x => x.year == fy).map((x, i) => `<tr><td>${i+1}</td><td>${x.date}</td><td>${x.name}</td><td>‚Çπ ${Number(x.amt).toLocaleString()}</td></tr>`).join('');
        Object.values(localData.donations).filter(x => x.year == fy).forEach(x => tin += Number(x.amt));
        Object.values(localData.expenses).filter(x => x.year == fy).forEach(x => tout += Number(x.amt));

        document.getElementById('printArea').innerHTML = `
            <div class="report-wrapper">
                <div class="report-header">
                    <h1 style="font-family:Cinzel; font-size:28px; margin:0;">52nd SAHID DIWAS 2026</h1>
                    <h2 style="font-family:Cinzel; font-size:22px; margin:5px 0;">B.B.C MARANG BUNDU</h2>
                    <div style="font-weight:bold;">Reg.no :- MBJ8750 - 13 Of 2022</div>
                    <div class="report-title">${type === 'don' ? 'COLLECTION' : 'EXPENDITURE'} LEDGER REPORT</div>
                    <div style="font-weight:bold; margin-top:5px;">SESSION YEAR: ${fy}</div>
                </div>
                <table class="report-table">
                    <thead><tr><th>S.N</th><th>Date</th><th>Particulars / Description</th><th>Amount (‚Çπ)</th></tr></thead>
                    <tbody>${rows}</tbody>
                </table>
                <div class="report-summary">
                    <div>TOTAL COLLECTIONS<br>‚Çπ ${tin.toLocaleString()}</div>
                    <div>TOTAL EXPENDITURES<br>‚Çπ ${tout.toLocaleString()}</div>
                    <div>NET BALANCE<br>‚Çπ ${(tin-tout).toLocaleString()}</div>
                </div>
                <div class="report-sig-row">
                    <div class="sig-box-final"><span class="sig-font">${localData.config.atName}</span><div class="sig-line">Assistant Treasurer</div></div>
                    <div class="sig-box-final"><span class="sig-font">${localData.config.tName}</span><div class="sig-line">Principal Treasurer</div></div>
                </div>
                <div style="text-align:center; margin-top:auto; font-size:11px; font-style:italic; border-top:1px solid #ccc; padding-top:5px;">This is a system generated report by Treasure Books Elite.</div>
            </div>`;
        window.print();
        style.remove();
    }

    (function init() {
        const s = document.getElementById('yearFilter');
        for (let y = 2026; y <= 2050; y++) {
            let o = document.createElement('option'); o.value = y; o.text = "Session " + y;
            if(y === 2026) o.selected = true; s.appendChild(o);
        }
        document.getElementById('eDate').valueAsDate = new Date();
    })();
</script>
</body>
</html>
