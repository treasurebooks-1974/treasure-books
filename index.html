<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREASURE BOOK - Master Edition 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Playfair+Display:ital,wght@0,700;1,700&family=Dancing+Script:wght@600&display=swap');
        
        :root { 
            --navy: #060b26; --gold: #b8860b; --premium-gold: #ffd700; 
            --glass: rgba(255, 255, 255, 0.96); --neon-blue: #00d2ff;
        }
        
        body { 
            font-family: 'Inter', sans-serif; background: #020512;
            margin: 0; padding: 15px; color: #333; min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }

        .premium-frame {
            position: relative; width: 100%; max-width: 1100px; padding: 4px;
            background: linear-gradient(90deg, #060b26, #b8860b, #00d2ff, #b8860b, #060b26);
            background-size: 300% 300%; animation: glowRotate 8s linear infinite;
            border-radius: 40px; box-shadow: 0 0 50px rgba(184, 134, 11, 0.4);
        }
        @keyframes glowRotate { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        .container { 
            background: var(--glass); border-radius: 38px; padding: 45px; 
            position: relative; width: 100%; box-sizing: border-box;
            backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.5);
        }
        
        .year-control-nano {
            position: absolute; top: 20px; right: 30px;
            background: var(--navy); color: var(--premium-gold); padding: 4px 10px;
            border-radius: 8px; font-size: 11px; font-weight: 900;
            border: 1px solid var(--gold); display: flex; align-items: center; gap: 5px;
        }
        .year-control-nano select { background: transparent; color: #fff; border: none; font-weight: 800; outline: none; cursor: pointer; }

        .brand-header { text-align: center; margin-bottom: 40px; }
        .brand-header h1 { color: var(--navy); font-size: 42px; font-weight: 900; letter-spacing: 6px; margin: 0; }
        .brand-header h2 { color: var(--gold); font-size: 24px; font-weight: 800; margin: 10px 0; }
        .brand-header p { color: #444; font-size: 13px; font-weight: 700; background: rgba(184, 134, 11, 0.1); display: inline-block; padding: 6px 20px; border-radius: 30px; }

        .executive-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .exec-card { background: #fff; padding: 15px; border-radius: 20px; border: 1.5px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; position: relative; }
        .exec-card span { font-size: 10px; color: #64748b; font-weight: 900; text-transform: uppercase; }
        .exec-card b { font-size: 18px; color: var(--navy); border-bottom: 2px solid var(--gold); }
        .exec-edit { position: absolute; right: 10px; top: 10px; font-size: 10px; cursor: pointer; color: #ef4444; border: none; background: none; font-weight: 900; }

        .entry-section { background: #fdfdfd; padding: 25px; border-radius: 25px; border: 1px solid #edf2f7; margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        input, select { padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 14px; font-weight: 600; outline: none; }
        .btn-save-compact { background: var(--navy); color: white; border: none; border-radius: 12px; padding: 14px 40px; font-size: 15px; font-weight: 900; cursor: pointer; margin: 20px auto 0; display: block; box-shadow: 0 10px 20px rgba(6, 11, 38, 0.2); }

        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 35px; }
        .card { padding: 20px; border-radius: 25px; color: white; text-align: center; font-weight: 900; font-size: 12px; }
        .bg-blue { background: linear-gradient(135deg, #060b26, #1a2a6c); border-bottom: 4px solid var(--neon-blue); }
        .bg-red { background: linear-gradient(135deg, #7f1d1d, #ef4444); border-bottom: 4px solid #fca5a5; }
        .bg-green { background: linear-gradient(135deg, #064e3b, #10b981); border-bottom: 4px solid #6ee7b7; }

        .list-section { background: white; border-radius: 30px; padding: 25px; border: 1.5px solid #f1f5f9; margin-bottom: 30px; }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .list-title { font-size: 14px; font-weight: 900; color: var(--navy); }
        .btn-print-icon { background: var(--navy); color: var(--premium-gold); border: 1px solid var(--gold); padding: 8px 15px; border-radius: 10px; cursor: pointer; font-size: 16px; }

        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; color: #64748b; padding: 15px; text-align: left; font-size: 10px; text-transform: uppercase; font-weight: 900; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; font-weight: 600; }

        .act-btn { border: none; padding: 8px 12px; border-radius: 8px; color: white; cursor: pointer; font-size: 10px; font-weight: 800; margin-right: 4px; }
        .btn-r { background: var(--gold); } .btn-edit { background: #38bdf8; } .btn-del { background: #f87171; }

        #printArea { display: none; }

        /* --- ðŸš€ PREMIUM PRINT DESIGN --- */
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; display: block !important; }

            .ledger-container { padding: 30px; min-height: 290mm; background: white; }
            .ledger-border { border: 4px double #000; padding: 20px; min-height: 260mm; position: relative; }
            .print-header { text-align: center; border-bottom: 3px solid #000; margin-bottom: 20px; padding-bottom: 10px; }
            .print-header h1 { font-size: 32px; margin: 0; text-transform: uppercase; }
            .print-type-label { font-size: 20px; font-weight: 900; text-decoration: underline; margin: 15px 0; display: block; text-align: center; }
            
            .print-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            .print-table th { background: #000 !important; color: #fff !important; padding: 10px; border: 1px solid #000; -webkit-print-color-adjust: exact; }
            .print-table td { border: 1px solid #000; padding: 8px; font-size: 13px; font-weight: 700; color: #000; }
            
            .total-summary-print { margin-top: 30px; border: 3px solid #000; padding: 15px; display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; font-weight: 900; background: #eee !important; -webkit-print-color-adjust: exact; }
            .signature-row { margin-top: 60px; display: flex; justify-content: space-between; padding: 0 30px; }
            .sig-box-p { text-align: center; width: 200px; border-top: 2px solid #000; padding-top: 5px; font-weight: 900; }

            /* Receipt Styles */
            .receipt-centered { display: flex; align-items: center; justify-content: center; height: 100vh; }
            .receipt-card { border: 2px solid #000; padding: 5px; width: 650px; }
            .receipt-inner { border: 5px double #000; padding: 30px; position: relative; }
            .data-row { display: flex; margin-bottom: 15px; border-bottom: 1px dotted #000; padding-bottom: 5px; font-size: 18px; }
            .data-label { font-weight: 800; min-width: 150px; font-size: 14px; }
            .amt-box { background: #000 !important; color: #fff !important; padding: 10px 25px; font-size: 24px; font-weight: 900; display: inline-block; -webkit-print-color-adjust: exact; margin: 15px 0; }
            .official-sig { font-family: 'Dancing Script', cursive; font-size: 35px; color: #081c5e !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

<div class="premium-frame no-print">
    <div class="container">
        <div class="year-control-nano">YR <select id="yearFilter" onchange="loadView()"></select></div>
        <div class="brand-header">
            <h1>TREASURE BOOK</h1>
            <h2>B.B.C MARANG BUNDU</h2>
            <p>Reg.no :- MBJ8750 - 13 Of 2022</p>
        </div>
        
        <div class="executive-info">
            <div class="exec-card"><span>Principal Treasurer</span><b id="tName">...</b><button class="exec-edit" onclick="editMember('tName', 'tName')">Edit</button></div>
            <div class="exec-card"><span>Asst Treasurer</span><b id="atName">...</b><button class="exec-edit" onclick="editMember('atName', 'atName')">Edit</button></div>
        </div>

        <div class="entry-section">
            <div class="form-grid">
                <input type="hidden" id="editKey"><input type="hidden" id="editType">
                <select id="eType" onchange="handleFormChange()"><option value="donation">CREDIT (Collection)</option><option value="expense">DEBIT (Expenditure)</option></select>
                <input type="date" id="eDate">
                <input type="text" id="eName" placeholder="Full Name or Detail">
                <select id="eOcc" onchange="checkExService()">
                    <option value="">Occupation</option>
                    <option value="Teacher">Teacher</option><option value="Police">Police</option><option value="Army">Army</option><option value="Navy">Navy</option><option value="Air Force">Air Force</option><option value="BSF">BSF</option><option value="CRPF">CRPF</option><option value="CISF">CISF</option><option value="ITBP">ITBP</option><option value="SSB">SSB</option><option value="Railway">Railway</option><option value="Student">Student</option><option value="Farmer">Farmer</option><option value="Business">Business</option><option value="Social Worker">Social Worker</option><option value="Ex-Service">Ex-Service</option><option value="Other">Other</option>
                </select>
                <select id="eSubOcc" style="display:none;"><option value="">Branch List</option><option value="Army">Army</option><option value="Navy">Navy</option><option value="Air Force">Air Force</option><option value="Police">Police</option><option value="Railway">Railway</option><option value="Teacher">Teacher</option></select>
                <input type="text" id="eRecBy" placeholder="Received By" style="display:none;">
                <input type="number" id="eAmount" placeholder="Amount â‚¹">
            </div>
            <button class="btn-save-compact" id="saveBtn" onclick="saveEntry()">CONFIRM TRANSACTION</button>
        </div>

        <div class="stats">
            <div class="card bg-blue">COLLECTION <br><b id="sumIn">0</b></div>
            <div class="card bg-red">EXPENDITURE <br><b id="sumOut">0</b></div>
            <div class="card bg-green">NET BALANCE <br><b id="sumBal">0</b></div>
        </div>

        <div class="list-section">
            <div class="list-header"><div class="list-title">ðŸ’° CREDIT LEDGER</div><button class="btn-print-icon" onclick="printReport('don')">âŽ™ Print Ledger</button></div>
            <table id="tblDon"><thead><tr><th>Sl</th><th>Date</th><th>Donor Name</th><th>Occupation</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyDon"></tbody></table>
        </div>

        <div class="list-section">
            <div class="list-header"><div class="list-title">ðŸ“‰ DEBIT LEDGER</div><button class="btn-print-icon" onclick="printReport('exp')">âŽ™ Print Ledger</button></div>
            <table id="tblExp"><thead><tr><th>Sl</th><th>Date</th><th>Particulars</th><th>Amt</th><th>Action</th></tr></thead><tbody id="bodyExp"></tbody></table>
        </div>
    </div>
</div>

<div id="printArea"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_xB865cARTIZI5XFj7SMaA3c_xPfaDpc",
        authDomain: "treasure-books-a655d.firebaseapp.com",
        databaseURL: "https://treasure-books-a655d-default-rtdb.firebaseio.com",
        projectId: "treasure-books-a655d",
        storageBucket: "treasure-books-a655d.firebasestorage.app",
        messagingSenderId: "543411661924",
        appId: "1:543411661924:web:e87cdddfa8e839b47a8371"
    };

    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database();
    let currentData = { donations: {}, expenses: {} };

    function formatDate(dateStr) {
        if(!dateStr) return "-";
        const [y, m, d] = dateStr.split('-');
        return `${d}/${m}/${y}`;
    }

    function numberToWords(num) {
        const a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        let n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
        if (!n) return '';
        let str = '';
        str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
        str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
        str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
        str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
        str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only' : '';
        return str.trim();
    }

    function getSahidYear(year) {
        let count = parseInt(year) - 1974;
        let suffix = (count % 10 == 1 && count != 11) ? "st" : (count % 10 == 2 && count != 12) ? "nd" : (count % 10 == 3 && count != 13) ? "rd" : "th";
        return `${count}${suffix} SAHID DIWAS ${year}`;
    }

    dbRef.ref().on('value', (snap) => {
        const val = snap.val() || {};
        currentData.donations = val.donations || {};
        currentData.expenses = val.expenses || {};
        document.getElementById('tName').innerText = val.config?.tName || "Principal Treasurer";
        document.getElementById('atName').innerText = val.config?.atName || "Asst Treasurer";
        loadView();
    });

    function loadView() {
        const fYear = document.getElementById('yearFilter').value;
        let bDon = document.getElementById('bodyDon'), bExp = document.getElementById('bodyExp');
        let tIn = 0, tOut = 0; bDon.innerHTML = ''; bExp.innerHTML = '';
        let slDon = 1, slExp = 1;
        
        Object.entries(currentData.donations).sort((a,b)=>new Date(a[1].date)-new Date(b[1].date)).forEach(([k, x]) => {
            if(x.year == fYear) {
                bDon.innerHTML += `<tr><td>${slDon++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td><td>${x.occ}</td><td>â‚¹${x.amt.toLocaleString()}</td><td><button class="act-btn btn-r" onclick="printReceipt('${k}')">Bill</button><button class="act-btn btn-edit" onclick="editEntry('don', '${k}')">E</button><button class="act-btn btn-del" onclick="deleteEntry('don', '${k}')">X</button></td></tr>`;
                tIn += x.amt;
            }
        });

        Object.entries(currentData.expenses).sort((a,b)=>new Date(a[1].date)-new Date(b[1].date)).forEach(([k, x]) => {
            if(x.year == fYear) {
                bExp.innerHTML += `<tr><td>${slExp++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td><td>â‚¹${x.amt.toLocaleString()}</td><td><button class="act-btn btn-edit" onclick="editEntry('exp', '${k}')">E</button><button class="act-btn btn-del" onclick="deleteEntry('exp', '${k}')">X</button></td></tr>`;
                tOut += x.amt;
            }
        });
        document.getElementById('sumIn').innerText = tIn.toLocaleString();
        document.getElementById('sumOut').innerText = tOut.toLocaleString();
        document.getElementById('sumBal').innerText = (tIn - tOut).toLocaleString();
    }

    function saveEntry() {
        const type = document.getElementById('eType').value, date = document.getElementById('eDate').value, name = document.getElementById('eName').value, amt = parseFloat(document.getElementById('eAmount').value), editKey = document.getElementById('editKey').value, occ = document.getElementById('eOcc').value;
        let recBy = document.getElementById('eRecBy').value || document.getElementById('tName').innerText;
        if(!date || !name || isNaN(amt)) return alert("Fill all details!");
        
        let finalOcc = (occ === "Ex-Service") ? "Ex-Service (" + document.getElementById('eSubOcc').value + ")" : (occ || "-");
        const entry = { date, name, occ: (type==='donation'?finalOcc:'-'), amt, recBy: (type==='donation'?recBy:''), year: new Date(date).getFullYear() };
        
        if(editKey) dbRef.ref((document.getElementById('editType').value === 'donation' ? 'donations/' : 'expenses/') + editKey).remove();
        dbRef.ref((type === 'donation' ? 'donations/' : 'expenses/')).push(entry);
        
        document.getElementById('eName').value = ''; document.getElementById('eAmount').value = ''; document.getElementById('editKey').value = ''; 
        document.getElementById('saveBtn').innerText = "CONFIRM TRANSACTION";
    }

    function editEntry(type, key) {
        const item = type === 'don' ? currentData.donations[key] : currentData.expenses[key];
        document.getElementById('eType').value = type === 'don' ? 'donation' : 'expense';
        document.getElementById('eDate').value = item.date;
        document.getElementById('eName').value = item.name;
        document.getElementById('eAmount').value = item.amt;
        document.getElementById('editKey').value = key;
        document.getElementById('editType').value = type === 'don' ? 'donation' : 'expense';
        handleFormChange();
        document.getElementById('saveBtn').innerText = "UPDATE NOW";
        window.scrollTo(0,0);
    }

    function deleteEntry(type, key) { if(confirm("Delete this entry?")) dbRef.ref((type === 'don' ? 'donations/' : 'expenses/') + key).remove(); }

    function printReceipt(key) {
        const item = currentData.donations[key], trName = document.getElementById('tName').innerText;
        document.getElementById('printArea').innerHTML = `
        <div class="receipt-centered">
            <div class="receipt-card"><div class="receipt-inner">
                <div class="print-header"><h1>${getSahidYear(item.year)}</h1><h2>B.B.C MARANG BUNDU</h2><p>Reg.no :- MBJ8750 - 13 Of 2022</p><br><b style="text-decoration:underline">DONATION RECEIPT</b></div>
                <div class="data-row"><span class="data-label">Donor Name:</span><span>${item.name}</span></div>
                <div class="data-row"><span class="data-label">Occupation:</span><span>${item.occ}</span></div>
                <div class="data-row"><span class="data-label">Date:</span><span>${formatDate(item.date)}</span></div>
                <div style="background:#f9f9f9; padding:10px; border-left:5px solid #000; margin:15px 0;"><b>In Words:</b> Rupees ${numberToWords(item.amt)}</div>
                <div class="amt-box">â‚¹ ${item.amt.toLocaleString()} /-</div>
                <div style="text-align:right; margin-top:30px;"><span class="official-sig">${trName}</span><br><b>Principal Treasurer</b></div>
            </div></div>
        </div>`;
        window.print();
    }

    function printReport(type) {
        const year = document.getElementById('yearFilter').value;
        const title = type === 'don' ? "OFFICIAL CREDIT LEDGER (COLLECTION)" : "OFFICIAL DEBIT LEDGER (EXPENDITURE)";
        let rows = ""; let sl = 1; let data = type === 'don' ? currentData.donations : currentData.expenses;
        
        Object.values(data).filter(x => x.year == year).sort((a,b) => new Date(a.date) - new Date(b.date)).forEach(x => { 
            rows += `<tr><td>${sl++}</td><td>${formatDate(x.date)}</td><td>${x.name}</td>${type==='don'?`<td>${x.occ}</td><td>${x.recBy || '-'}</td>`:''}<td>â‚¹${x.amt.toLocaleString()}</td></tr>`; 
        });

        document.getElementById('printArea').innerHTML = `
        <div class="ledger-container"><div class="ledger-border">
            <div class="print-header"><h1>${getSahidYear(year)}</h1><h2>B.B.C MARANG BUNDU</h2><span class="print-type-label">${title}</span></div>
            <table class="print-table"><thead>
                ${type==='don'?'<tr><th>Sl</th><th>Date</th><th>Donor Name</th><th>Occupation</th><th>RecBy</th><th>Amount</th></tr>':'<tr><th>Sl</th><th>Date</th><th>Particulars</th><th>Amount</th></tr>'}
            </thead><tbody>${rows}</tbody></table>
            <div class="total-summary-print">
                <div>COLLECTION<br>â‚¹ ${document.getElementById('sumIn').innerText}</div>
                <div>EXPENDITURE<br>â‚¹ ${document.getElementById('sumOut').innerText}</div>
                <div>NET BALANCE<br>â‚¹ ${document.getElementById('sumBal').innerText}</div>
            </div>
            <div class="signature-row"><div class="sig-box-p">General Secretary</div><div class="sig-box-p">Principal Treasurer</div></div>
        </div></div>`;
        window.print();
    }

    function buildYearDropdown() { const sel = document.getElementById('yearFilter'); for (let y = 2024; y <= 2030; y++) { let opt = document.createElement('option'); opt.value = y; opt.text = y; if(y === new Date().getFullYear()) opt.selected = true; sel.appendChild(opt); } }
    function editMember(elId, field) { let v = prompt("Enter Name:", document.getElementById(elId).innerText); if(v) dbRef.ref('config/' + field).set(v); }
    function checkExService() { document.getElementById('eSubOcc').style.display = (document.getElementById('eOcc').value === "Ex-Service") ? "inline-block" : "none"; }
    function handleFormChange() { 
        const isDon = document.getElementById('eType').value === 'donation';
        document.getElementById('eOcc').style.display = isDon ? "inline-block" : "none"; 
        document.getElementById('eRecBy').style.display = isDon ? "inline-block" : "none";
        checkExService();
    }
    window.onload = () => { buildYearDropdown(); document.getElementById('eDate').valueAsDate = new Date(); handleFormChange(); };
</script>
</body>
</html>
